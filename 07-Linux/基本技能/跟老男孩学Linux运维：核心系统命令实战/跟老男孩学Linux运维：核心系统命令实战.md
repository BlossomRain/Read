# 跟老男孩学Linux运维：核心系统命令实战

- [ ] 书籍作者：老男孩，张耀
- [ ] 笔记时间：2021.8.3

## 第1章 Linux命令行简介

### 1.1 Linux命令行概述

- 命令提示符 #结尾是超级用户 root，＄结尾是普通用户，通过修改PS1可以自定义提示符 `set | grep PS1`
- 常用快捷键![]( https://res.weread.qq.com/wrepub/epub_922339_7)![](images/epub_922339_8)

### 1.2 在Linux命令行下查看命令帮助

- man | --help | info

### 1.3 Linux关机、重启、注销命令

- shutdown -r 重启，-h 定时，远离发送请求给init进程调整运行级别，可以查看 /etc/inittab
- halt/poweroff/reboot 都是重启，电源关闭与否的差别。

## 第2章 文件和目录操作命令

### 2.1 pwd：显示当前所在的位置

- -L 显示逻辑路径，和 ＄PWD，-P显示软连接对应的源文件

### 2.2 cd：切换目录

- -切换到上次路径 

### 2.3 tree：以树形结构显示目录下的内容

- 参数和ls差不多，-i不显示树枝，-L指定最大层数

### 2.4 mkdir：创建目录

- m可以指定权限，路径可以用花括号指定多个
- 可以通过读取文件形式批量创建

### 2.5 touch：创建空文件或改变文件的时间戳属性

- 时间戳有三种类型 Access Change Modify

### 2.6 ls：显示目录下的内容及相关属性信息

- t根据修改时间排序，`--time-style=long-iso`格式化
- `ls -lrt` 显示最近更新时间

### 2.7 cp：复制文件或目录

- a保持源文件的所有者权限等信息，递归 。
- 可以利用花括号展开原理快速备份，空可以用逗号隔开

### 2.8 mv：移动或重命名文件

### 2.9 rm：删除文件或目录

- 可以先用mv移动到/tmp或者备份后再删除

### 2.10 rmdir：删除空目录

### 2.11 ln：硬链接与软链接

- 硬链接生成普通文件，通过索引节点进行链接，只有个数为空才能真正删除文件
- 软连接生成符号链接文件，类似快捷方式

### 2.12 readlink：查看符号链接文件的内容

- f 查看符号链接文件的最后非符号连接文件名

### 2.13 find：查找目录下的文件

- ![](images/epub_922339_64)

- ```shell
  find . -atime 2 #两天内修改过的文件
  find . ! -type d -exec ls {} \; #不是目录的文件,并列出来
  ```

- `xargs` 可以接收参数执行命令，查找结果一次性接收 ，需要处理特殊文件名。

### 2.14 xargs：将标准输入转换成命令行参数

- n 指定每行最带参数量，i用花括号代替前面的结果，d指定分隔符 ，0使用null替代空格

### 2.15 rename：重命名文件

### 2.16 basename：显示文件名或目录名

### 2.17 dirname：显示文件或目录路径

### 2.18 chattr：改变文件的扩展属性

- +a不可删除文件，+i加锁，lsattr` 可以查看扩展属性

### 2.19 lsattr：查看文件扩展属性

### 2.20 file：显示文件的类型

### 2.21 md5sum：计算和校验文件的MD5值

- c校验

### 2.22 chown：改变文件或目录的用户和用户组

- 用户：用户组，参数顺序

### 2.23 chmod：改变文件或目录权限

### 2.24 chgrp：更改文件用户组

### 2.25 umask：显示或设置权限掩码

- 通过八进制的数值来定义用户创建文件或目录的默认权限。起始权限-umask=真正默认权限

## 第3章 文件过滤及内容编辑处理命令

### 3.1 cat：合并文件或查看文件内容

- ```shell
  cat >> file <<EOF #多行输入，使用-EOF的话，可以使用tab缩进
  cat /dev/null<file	#清空
  # -n 编号，-b忽略空白行，-E显示行尾
  ```

### 3.2 tac：反向显示文件内容

### 3.3 more：分页显示文件内容

- num 从行号开始显示，交互模式可以使用b，f，/等命令

### 3.4 less：分页显示文件内容

- N显示行号，支持更多命令

### 3.5 head：显示文件内容头部

- n指定行数 

### 3.6 tail：显示文件内容尾部

- f实时输出

### 3.7 tailf：跟踪日志文件

### 3.8 cut：从文本中提取一段文字并输出

- c字符分割 ，d指定分隔符，f指定宣誓区域，N第n个字符

### 3.9 split：分割文件

- ```shell
  split -l 1 -a 4 -d txt  new_ #一行，新文件名开头new_，结尾4位数字
  ```

### 3.10 paste：合并文件

- d指定分隔符，默认tab，会合并到同一行。

### 3.11 sort：文本排序

- n数值大小，t指定分隔符 ，k指定区间

### 3.12 join：按两个文件的相同字段合并

- 跟paste差不多，字段可以重复合并

### 3.13 uniq：去除重复行

- c去除并计算出现次数

### 3.14 wc：统计文件的行数、单词数或字节数

- l行数，L最长行长度

### 3.15 iconv：转换文件的编码格式

- l显示支持的编码，o指定输出，f源文件编码，t目标文件编码

### 3.16 dos2unix：将DOS格式文件转换成UNIX格式

- 一些换行等的自动替换

### 3.17 diff：比较两个文件的不同

### 3.18 vimdiff：可视化比较工具

### 3.19 rev：反向输出文件内容

### 3.20 tr：替换或删除字符

- d删除字符，可以删除制表符
- 可以使用中括号范围替换
- s删除连续字符，c表示取反

### 3.21 od：按不同进制显示文件

### 3.22 tee：多重定向

- a表示追加

### 3.23 vi/vim：纯文本编辑器

## 第4章 文本处理三剑客

### 4.1 grep：文本过滤工具

- ```shell
  grep  opt pattern file
  # v 不显示匹配行，n显示匹配行和行号
  # i 不区分大小写，c 只统计行数
  # E 使用扩展egrep命令，w只匹配过滤的单词，o只输出内容
  grep -Ev "^$|#" conf # 过滤空行和注释
  ```

### 4.2 sed：字符流编辑器

- ```sh
  # -n 取消默认输出， -i直接修改文件内容
  # a/d/i/p 追加/删除/插入/打印
  # s/regexp/replace/
  ```

### 4.3 awk基础入门

- 不仅是命令，更是一门语

- ```shell
  awk 'NR==2,NR==6' file # 查看2-6行，NR表示行
  awk '{print NR,$0}' file # 加上行号打印，＄0表示行内容
  awk -F ":" '{print $1,$3,$NF}' txt # 用冒号分隔，打印1，3，最后一列
  awk '{gsub("/sbin/nologin","/bin/bash",$0);print $0}' txt # 将文件中的字符串进行替换
  ifconfig eth0 | awk -F "[ :]+" 'NR==2 {print $3}' # 提取IP地址
  
  ```

## 第5章 Linux信息显示与搜索文件命令

### 5.1 uname：显示系统信息

- a全部信息，n名字，r版本 

### 5.2 hostname：显示或设置系统的主机名

- 修改/etc/hostname
- I/i 可以显示主机IP地址

### 5.3 dmesg：系统启动异常诊断

- dmesg用于显示内核环形缓冲区（kernel-ring buffer）的内容。在进行系统引导时，内核会将硬件和模块初始化相关的信息写到这个缓冲区中
- 默认保存在 /var/log目录里面

### 5.4 stat：显示文件或文件系统状态

- f显示文件系统属性，c可以指定需要的数据

### 5.5 du：统计磁盘空间使用情况

### 5.6 date：显示与设置系统时间

- F长格式显示日期，T长格式显示时间，d指定前后时间

### 5.7 echo：显示一行文本

- n不要自动换行 ，e解析

### 5.8 watch：监视命令执行情况

- n指定间隔，d高亮显示

### 5.9 which：显示命令的全路径

### 5.10 whereis：显示命令及其相关文件全路径

### 5.11 locate：快速定位文件路径

### 5.12 updatedb：更新mlocate数据库

- 默认在  /var/lib/mlocate/mlocate.db

## 第6章 文件备份与压缩命令

### 6.1 tar：打包备份

- z通过gzip压缩/解压 ，c创建新tar包，v显示详细，f指定名字，t不解压查看内容
- x解压，C指定解压路径，h打包软连接真实文件

### 6.2 gzip：压缩或解压文件

- gzip命令不能直接压缩目录，因此目录需要先用tar打包成一个文件，然后tar再调用gzip进行压缩

### 6.3 zip：打包和压缩文件

- x排除

### 6.4 unzip：解压zip文件

### 6.5 scp：远程文件复制

- 适合第一次复制时使用，P端口号，p保留原始属性，r递归

### 6.6 rsync：文件同步工具

- 增量更新，z压缩，a递归，保持属性

- ```
  rsync -av --delete /null/ /tmp/ #批量删除
  ```

## 第7章 Linux用户管理及用户信息查询命令

### 7.1 useradd：创建用户

- s指定登录shell，u指定uid

### 7.2 usermod：修改用户信息

### 7.3 userdel：删除用户

- 在passwd使用注释就好

### 7.4 groupadd：创建新的用户组

### 7.5 groupdel：删除用户组

### 7.6 passwd：修改用户密码

- ```
  passwd -S root #显示密码
  echo "234456" | passwd --stdin root #批量设置密码很有用
  ```

### 7.7 chage：修改用户密码有效期

### 7.8 chpasswd：批量更新用户密码

### 7.9 su：切换用户

- -环境也会带过去，c指定执行脚本

### 7.10 visudo：编辑sudoers文件

### 7.11 sudo：以另一个用户身份执行命令

### 7.12 id：显示用户与用户组的信息

### 7.13 w：显示已登录用户信息

### 7.14 who：显示已登录用户信息

### 7.15 users：显示已登录用户

### 7.16 whoami：显示当前登录的用户名

### 7.17 last：显示用户登录列表

- /var/log/wtmp读取信息，n可以指定行数

### 7.18 lastb：显示用户登录失败的记录

### 7.19 lastlog：显示所有用户的最近登录记录

## 第8章 Linux磁盘与文件系统管理命令

### 8.1 fdisk：磁盘分区工具

- fdisk工具只能给小于2TB的磁盘划分分区，mbr分区

### 8.2 partprobe：更新内核的硬盘分区表信息

### 8.3 tune2fs：调整ext2/ext3/ext4文件系统参数

### 8.4 parted：磁盘分区工具

- gpt格式

### 8.5 mkfs：创建Linux文件系统

### 8.6 dumpe2fs：导出ext2/ext3/ext4文件系统信息

### 8.7 resize2fs：调整ext2/ext3/ext4文件系统大小

### 8.8 fsck：检查并修复Linux文件系统

### 8.9 dd：转换或复制文件

- if 输入，of输出，bs块大小，count块数

### 8.10 mount：挂载文件系统

### 8.12 df：报告文件系统磁盘空间的使用情况

- i节点信息

### 8.13 mkswap：创建交换分区

### 8.14 swapon：激活交换分区

### 8.16 sync：刷新文件系统缓冲区

## 第9章 Linux进程管理命令

### 9.1 ps：查看进程

- e所有进程，u用户信息，x终端无关进程，a终端相关进程，f额外显示
- H进程树，o自定义输出

### 9.2 pstree：显示进程状态树

### 9.3 pgrep：查找匹配条件的进程

### 9.4 kill：终止进程

- 信号0表示不发送信号，可以检测进程是否存在

### 9.5 killall：通过进程名终止进程

- u指定用户的进程

### 9.6 pkill：通过进程名终止进程

- 通过进程名终止进程

### 9.7 top：实时显示系统中各个进程的资源占用状况

- 可以使用交互式命令，查表即可

### 9.8 nice：调整程序运行时的优先级

### 9.9 renice：调整运行中的进程的优先级

### 9.10 nohup：用户退出系统进程继续工作

- 通常配合&使用

### 9.11 strace：跟踪进程的系统调用

### 9.12 ltrace：跟踪进程调用库函数

### 9.13 runlevel：输出当前运行级别

### 9.14 init：初始化Linux进程

### 9.15 service：管理系统服务

## 第10章 Linux网络管理命令

### 10.1 ifconfig：配置或显示网络接口信息

- up/down 开启，关闭
- 配置别名IP `ifconfig eth0:1 ip/24 up`

### 10.2 ifup：激活网络接口

### 10.4 route：显示或管理路由表

- add/del/-net/-host/netmask/gw/dev If 增加/删除/到网络/到主机/发往目标/指定设备  路由

### 10.5 arp：管理系统的arp缓存

### 10.6 ip：网络配置工具

- 很强大，可以替代上面的IP/路由命令

### 10.7 netstat：查看网络状态

- n数字形式显示，a监听的socket信息，c隔几秒刷新，t/u表示Tcp/Udp，p显示PID

### 10.8 ss：查看网络状态

- 取代上者的命令，n显示IP地址，l监听的socket，p使用socket的进程

### 10.9 ping：测试主机之间网络的连通性

- 执行ping命令会使用ICMP传输协议，c次数，i间隔

### 10.10 traceroute：追踪数据传输路由状况

- 默认udp，可以使用-I调用ICMP协议

### 10.11 arping：发送arp请求

- arping命令是用于发送arp请求到一个相邻主机的工具，arping使用arp数据包检查局域网内所有设备的硬件地址。
- f收到第一个报文就退出

### 10.12 telnet：远程登录主机

- 明文登录，一般采用ssh

### 10.13 nc：多功能网络工具

- 需要关闭防火墙和selinux
- 可以实现tcp发送，手动建立HTTP链接，端口扫描

### 10.14 ssh：安全地远程登录主机

- p指定端口，t强制分配伪终端，v调试模式

### 10.15 wget：命令行下载工具

- 稳定，断点下载，支持http和ftp
- --limit-rate 限速 ，-c断点续传 ，--spider模拟爬虫

### 10.16 mailq：显示邮件传输队列

### 10.17 mail：发送和接收邮件

- s指定主题，a指定附件
- 需要自己搭建邮件服务器

### 10.18 nslookup：域名查询工具

- server 指定域名，set K=V 设置关键之的值

### 10.19 dig：域名查询工具

- @DNS服务器，t指定查询类型，+trace根域开始追踪，x反向解析

### 10.20 host：域名查询工具

- host命令是用于查询DNS的工具，它可以将指定主机名称转换为IP地址。

### 10.21 nmap：网络探测工具和安全/端口扫描器

- nmap命令是一款开放源代码的网络探测和安全审核工具，是Network Mapper的缩写
- sS同步扫描TCP，

### 10.22 tcpdump：监听网络流量

- tcpdump命令是一个截获网络数据包的包分析工具。tcpdump可以将网络中传送的数据包的“头”完全截获下来以提供分析
- tcpdump命令工作时要先把网卡的工作模式切换到混杂模式
- c指定包数目后退出，i监听接口，nn不转为名字，q快速输出

## 第11章 Linux系统管理命令

### 11.1 lsof：查看进程打开的文件

### 11.2 uptime：显示系统的运行时间及负载

### 11.3 free：查看系统内存信息

- s 间隔刷新

### 11.4 iftop：动态显示网络接口流量信息

- i指定接口，P显示端口，p设置网卡混杂模式，

### 11.5 vmstat：虚拟内存统计

- s内存相关信息统计

### 11.6 mpstat：CPU信息统计

- 可以查看多核心CPU中每个计算核心的统计数据，是一种实时系统监控工具。mpstat命令会输出CPU的一些统计信息，这些信息存放在/proc/stat文件中

### 11.7 iostat：I/O信息统计

- 主要是显示磁盘读写操作的统计信息，同时也会给出CPU的使用情况。

### 11.8 iotop：动态显示磁盘I/O统计信息

### 11.9 sar：收集系统信息

- u显示CPU负载，d硬盘使用，r内存使用，b缓冲区使用，n网络使用，q运行队列大小，

### 11.10 chkconfig：管理开机服务

- --list 服务启动状态，--add/del添加删除，--level指定运行级别

- chkconfig的原理是在runlevel级别的/etc/rc.d/rc*.d目录中将对应服务做一个以S或K开头的软链接。

### 11.11 ntsysv：管理开机服务

- ntsysv命令提供了一种基于文本界面的菜单操作方式，以设置不同运行级别下的系统服务启动状态

### 11.12 setup：系统管理工具

- setup命令是一个基于文本界面的系统管理工具，集成了用户认证管理、防火墙管理、网络管理和系统服务管理。

### 11.13 ethtool：查询网卡参数

### 11.14 mii-tool：管理网络接口的状态

### 11.15 dmidecode：查询系统硬件信息

### 11.16 lspci：显示所有PCI设备

### 11.17 ipcs：显示进程间通信设施的状态

### 11.18 ipcrm：清除ipc相关信息

### 11.19 rpm：RPM包管理器

- q查询，p接软件包，i安装，l列表，R依赖，h进度条，a所有，e卸载，f查询属于哪个软件包

### 11.20 yum：自动化RPM包管理工具

## 第12章 Linux系统常用内置命令

### 12.1 Linux内置命令概述

### 12.2 Linux内置命令简介

### 12.3 Linux常用内置命令实例

- 冒号代表占位符
